<div class="editor-container">
  <mat-form-field
    class="topic-control"
    appearance="outline"
    subscriptSizing="dynamic"
  >
    <mat-label>Round topic</mat-label>
    <input
      placeholder="Add a JIRA ticket or a short description of the current round"
      [formControl]="roundTopic"
      cdkFocusInitial
      matInput
      id="topic-name"
      type="text"
      [matAutocomplete]="auto"
      #topicInput
    />
    <mat-spinner
      *ngIf="isSearching"
      matSuffix
      diameter="20"
      class="jira-loading"
    ></mat-spinner>
    <mat-autocomplete
      #auto="matAutocomplete"
      [displayWith]="displayFn"
      (optionSelected)="issueSelected($event.option.value)"
    >
      <ng-container *ngIf="jiraIssues$ | async as jiraIssues">
        <mat-optgroup *ngIf="jiraIssues.search.length" label="Issue search">
          <mat-option *ngFor="let issue of jiraIssues.search" [value]="issue">
            {{ issue.key }}: {{ issue.summary }}
          </mat-option>
        </mat-optgroup>
        <mat-optgroup *ngIf="jiraIssues.recent.length" label="Recent issues">
          <mat-option *ngFor="let issue of jiraIssues.recent" [value]="issue">
            {{ issue.key }}: {{ issue.summary }}
          </mat-option>
        </mat-optgroup>
      </ng-container>
    </mat-autocomplete>
  </mat-form-field>
  <div class="buttons">
    <button matSuffix mat-stroked-button (click)="showRecents.next()">
      <span class="button-with-custom-icon">
        <img class="jira-icon" src="/assets/jira.png" />
        {{ (jiraIntegration$ | async) ? "Recent issues" : "Connect to Jira" }}
      </span>
    </button>
    <button matSuffix mat-flat-button color="primary" (click)="topicBlur()">
      <mat-icon>save</mat-icon>
      Save topic
    </button>
  </div>
</div>
<div class="rich-topic" *ngIf="selectedRichTopic">
  <div class="rich-topic-header">
    <mat-chip color="primary">{{ selectedRichTopic.key }}</mat-chip>
    <button mat-flat-button>
      <span class="button-with-custom-icon">
        <img class="jira-icon" src="/assets/jira.png" />
        View in Jira
      </span>
    </button>
  </div>
  <div class="rich-topic-body">
    <markdown
      [data]="selectedRichTopic.description ?? 'No description available'"
    >
    </markdown>
  </div>
</div>
