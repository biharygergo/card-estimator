<h1 mat-dialog-title class="dialog-title">
  Summary <mat-chip class="beta-chip">Beta</mat-chip>
</h1>
<div mat-dialog-content>
  <p class="disclaimer">
    The below summary was generated by ChatGPT acting like your team's SCRUM
    master. It may produce inaccurate information about this planning session.
  </p>
  <div class="summary">
    <div class="summary-response">
      <div
        class="middle-text"
        *ngIf="failedPrecondition$ | async as failedPrecondition"
      >
        <ng-container *ngIf="failedPrecondition === 'room-size'">
          <h2>Not enough data</h2>
          <p>
            To generate a meaningful summary, you must have at least three
            rounds and another member in this room.
          </p>
        </ng-container>
        <ng-container *ngIf="failedPrecondition === 'user'">
          <h2>No user account</h2>
          <p>
            You need a permanent Planning Poker account to view or generate a
            summary.
          </p>
        </ng-container>
        <ng-container
          *ngIf="
            failedPrecondition === 'credits' &&
            (summaryResponse$ | async) === undefined
          "
        >
          <h2>Oops!</h2>
          <p>You are out of your monthly free credits.</p>
          <p>
            Upgrade to Premium to get unlimited room summaries and much more!
          </p>
        </ng-container>
      </div>
      <div class="response-text" id="response-text"></div>

      <div
        class="loading-blocks"
        *ngIf="
          (summaryResponse$ | async) === undefined &&
          (failedPrecondition$ | async) === undefined
        "
      >
        <div class="loading-block"></div>
        <div class="loading-block"></div>
        <div class="loading-block"></div>
        <div class="loading-block"></div>
        <div class="loading-block"></div>
        <div class="loading-block"></div>
        <div class="loading-block"></div>
      </div>
    </div>
    <div class="summary-buttons">
      <button
        mat-button
        (click)="generateSummary()"
        *ngIf="!(showOutOfCredits$ | async); else getPremiumButton"
        [disabled]="!!(failedPrecondition$ | async)"
      >
        <mat-icon>refresh</mat-icon>
        Regenerate
      </button>
      <ng-template #getPremiumButton>
        <button mat-button color="primary" (click)="upgradeToPremium()">
          <mat-icon>add</mat-icon>
          Upgrade to Premium
        </button>
      </ng-template>
      <span class="free-credits" *ngIf="!(isPremiumSubscriber$ | async)">
        <span *ngIf="!(showOutOfCredits$ | async); else outOfCredits">
          {{ remainingUsage$ | async }} out of {{ USAGE_LIMIT }} monthly credits
          left
        </span>
        <ng-template #outOfCredits>
          You are out of monthly credits
        </ng-template>
      </span>
    </div>
  </div>
  <div mat-dialog-actions>
    <button
      mat-flat-button
      color="primary"
      (click)="copyToClipboard()"
      [disabled]="!(summaryResponse$ | async)?.length"
      cdkFocusInitial
    >
      <mat-icon>content_copy</mat-icon>
      Copy summary
    </button>
    <button mat-button mat-dialog-close>Cancel</button>
  </div>
</div>
