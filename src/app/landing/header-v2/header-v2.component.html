<nav [ngClass]="{ open: isOpen, scrolled: isScrolled }">
  <div class="header-container" [ngClass]="{ scrolled: isScrolled }">
    @if (isEmbeddedApp) {
      <button mat-flat-button (click)="goBack()">
        <mat-icon>chevron_left</mat-icon>Back
      </button>
    }
    @if (!isEmbeddedApp) {
      <a routerLink="/" (click)="closeMenu()">
        <div class="logo-container">
          <picture>
            <source srcset="/assets/logo.webp" type="image/webp" />
            <source srcset="/assets/logo.png" type="image/png" />
            <img
              src="/assets/logo.png"
              alt="Planning Poker logo"
              loading="lazy" />
          </picture>
          <span>PlanningPoker.live</span>
        </div>
      </a>
      <ul [ngClass]="{ hidden: isScrolled }">
        <li>
          <div
            class="navigation-button features-button split-button"
            routerLinkActive="active"
            (mouseenter)="onDropdownMouseEnter('features')"
            (mouseleave)="onDropdownMouseLeave()">
            <a class="split-button-left" routerLink="/features"
              >Features</a
            >
            <button
              class="split-button-right"
              mat-icon-button
              (click)="toggleFeaturesDropdown()"
              [attr.aria-expanded]="openDropdown === 'features'"
              aria-label="Expand features menu">
              <mat-icon
                class="rotating-icon"
                [class.rotated]="openDropdown === 'features'"
                [inline]="true"
                >expand_more</mat-icon
              >
            </button>
          </div>
          <div class="navbar-features-dropdown-panel" 
               [class.open]="openDropdown === 'features'"
               (mouseenter)="onDropdownContentMouseEnter()"
               (mouseleave)="onDropdownContentMouseLeave()">
              <div class="navbar-features-dropdown-content">
                <div class="navbar-features-section">
                  <h3>Learn & Get Started</h3>
                  <div class="navbar-features-grid">
                    <a routerLink="/getting-started" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>school</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Getting Started Guide</h4>
                        <p>Complete tutorial for new users</p>
                      </div>
                    </a>
                    <a routerLink="/what-is-planning-poker" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>help</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>What is Planning Poker?</h4>
                        <p>Learn the basics of agile estimation</p>
                      </div>
                    </a>
                    <a routerLink="/estimation-techniques-comparison" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>compare</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Estimation Techniques Comparison</h4>
                        <p>Planning Poker vs T-Shirt Sizing & more</p>
                      </div>
                    </a>
                    <a routerLink="/glossary" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>menu_book</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Glossary</h4>
                        <p>Agile & Planning Poker terminology</p>
                      </div>
                    </a>
                  </div>
                </div>
                
                <div class="navbar-features-section">
                  <h3>Resources & Support</h3>
                  <div class="navbar-features-grid">
                    <a routerLink="/features" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>book</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Features</h4>
                        <p>Learn about the features of Planning Poker.live</p>
                      </div>
                    </a>
                    <a routerLink="/knowledge-base" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>library_books</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Knowledge Base</h4>
                        <p>Advanced guides and tutorials</p>
                      </div>
                    </a>
                    <a routerLink="/faq" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <mat-icon>question_answer</mat-icon>
                      </div>
                      <div class="navbar-feature-content">
                        <h4>FAQ</h4>
                        <p>Answers to common questions</p>
                      </div>
                    </a>
                  </div>
                </div>
                
                <div class="navbar-features-highlight">
                  <div class="navbar-highlight-content">
                    <h4>ðŸš€ Ready to start?</h4>
                    <p>Create your first planning poker session in seconds</p>
                    <a mat-stroked-button routerLink="/create" (click)="closeAllDropdowns()">
                      Start Planning
                    </a>
                  </div>
                </div>
              </div>
            </div>
        </li>
        <li>
          <div
            class="navigation-button integrations-button split-button"
            routerLinkActive="active"
            (mouseenter)="onDropdownMouseEnter('integrations')"
            (mouseleave)="onDropdownMouseLeave()">
            <a class="split-button-left" routerLink="/integrations">Integrations</a>
            <button
              class="split-button-right"
              mat-icon-button
              (click)="toggleIntegrationsDropdown()"
              [attr.aria-expanded]="openDropdown === 'integrations'"
              aria-label="Expand integrations menu">
              <mat-icon
                class="rotating-icon"
                [class.rotated]="openDropdown === 'integrations'"
                [inline]="true"
                >expand_more</mat-icon
              >
            </button>
          </div>
          <div class="navbar-features-dropdown-panel" 
               [class.open]="openDropdown === 'integrations'"
               (mouseenter)="onDropdownContentMouseEnter()"
               (mouseleave)="onDropdownContentMouseLeave()">
              <div class="navbar-features-dropdown-content">
                <div class="navbar-features-section">
                  <h3>Video Conferencing</h3>
                  <div class="navbar-features-grid">
                    <a routerLink="/integrations/zoom" class="navbar-feature-card" (click)="closeAllDropdowns()" id="header-zoom-link">
                      <div class="navbar-feature-icon">
                        <img src="/assets/zoom-logo.png" alt="Zoom" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Zoom Meetings</h4>
                        <p>Built-in Planning Poker for Zoom calls</p>
                      </div>
                    </a>
                    <a routerLink="/integrations/teams" class="navbar-feature-card" (click)="closeAllDropdowns()" id="header-teams-link">
                      <div class="navbar-feature-icon">
                        <img src="/assets/teams_logo.png" alt="Microsoft Teams" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Microsoft Teams</h4>
                        <p>Seamless Planning Poker in Teams</p>
                      </div>
                    </a>
                    <a routerLink="/integrations/meet" class="navbar-feature-card" (click)="closeAllDropdowns()" id="header-meet-link">
                      <div class="navbar-feature-icon">
                        <img src="/assets/meet_logo.png" alt="Google Meet" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Google Meetâ„¢</h4>
                        <p>Planning Poker integrated with Meet</p>
                      </div>
                    </a>
                    <a routerLink="/integrations/webex" class="navbar-feature-card" (click)="closeAllDropdowns()" id="header-webex-link">
                      <div class="navbar-feature-icon">
                        <img src="/assets/webex_logo.png" alt="Webex" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Webex Meetings</h4>
                        <p>Planning Poker within Webex</p>
                      </div>
                    </a>
                  </div>
                </div>
                
                <div class="navbar-features-section">
                  <h3>Project Management</h3>
                  <div class="navbar-features-grid">
                    <a routerLink="/integrations/jira" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <img src="/assets/jira.png" alt="Jira" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Jira Tickets</h4>
                        <p>Sync issues and estimates with Jira</p>
                      </div>
                    </a>
                    <a routerLink="/integrations/linear" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <img src="/assets/linear.png" alt="Linear" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Linear Issues</h4>
                        <p>Import issues and push estimates back</p>
                      </div>
                    </a>
                  </div>
                </div>

                <div class="navbar-features-section">
                  <h3>Communication</h3>
                  <div class="navbar-features-grid">
                    <a routerLink="/integrations/slack" class="navbar-feature-card" (click)="closeAllDropdowns()">
                      <div class="navbar-feature-icon">
                        <img src="/assets/slack.png" alt="Slack" loading="lazy" />
                      </div>
                      <div class="navbar-feature-content">
                        <h4>Slack</h4>
                        <p>Start sessions with Slack commands</p>
                      </div>
                    </a>
                  </div>
                </div>
                
                <div class="navbar-features-highlight">
                  <div class="navbar-highlight-content">
                    <h4>ðŸš€ Ready to start?</h4>
                    <p>Create your first planning poker session in seconds</p>
                    <a mat-stroked-button routerLink="/create" (click)="closeAllDropdowns()">
                      Start Planning
                    </a>
                  </div>
                </div>
              </div>
            </div>
        </li>
        <li>
          <a
            routerLink="/pricing"
            routerLinkActive="active"
            (click)="closeAllDropdowns(); closeMenu()"
            class="navigation-button"
            >Pricing</a
          >
        </li>
      </ul>
      <div
        class="split-action-button-container flat desktop-start-planning-link">
        <a mat-flat-button color="primary" routerLink="/create"
          ><mat-icon>play_arrow</mat-icon>Start planning
        </a>
        <div class="split-action-button-container-side-button">
          <app-profile-dropdown appearance="avatar"></app-profile-dropdown>
        </div>
      </div>

      <button
        mat-icon-button
        aria-label="Toggle navigation menu"
        class="mobile-nav-toggle"
        (click)="toggleMenu()">
        <mat-icon>menu</mat-icon>
      </button>
    }
  </div>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" [class.open]="isOpen" (click)="closeMenu()">
    <div class="mobile-menu-content" [class.open]="isOpen" (click)="$event.stopPropagation()">
      <div class="mobile-menu-header">
        <div class="mobile-logo">
          <img src="/assets/logo.webp" alt="PlanningPoker.live" />
          <span>PlanningPoker.live</span>
        </div>
        <button class="mobile-close" (click)="closeMenu()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="mobile-menu-items">
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="mobile-menu-item" (click)="closeAllDropdowns(); closeMenu()">
          <div class="mobile-menu-icon">
            <mat-icon>home</mat-icon>
          </div>
          <span class="mobile-menu-text">Home</span>
        </a>

        <a routerLink="/features" routerLinkActive="active" class="mobile-menu-item" (click)="closeAllDropdowns(); closeMenu()">
          <div class="mobile-menu-icon">
            <mat-icon>star</mat-icon>
          </div>
          <span class="mobile-menu-text">Features</span>
        </a>

        <a routerLink="/integrations" routerLinkActive="active" class="mobile-menu-item" (click)="closeAllDropdowns(); closeMenu()">
          <div class="mobile-menu-icon">
            <mat-icon>integration_instructions</mat-icon>
          </div>
          <span class="mobile-menu-text">Integrations</span>
        </a>

        <a routerLink="/pricing" routerLinkActive="active" class="mobile-menu-item" (click)="closeAllDropdowns(); closeMenu()">
          <div class="mobile-menu-icon">
            <mat-icon>payments</mat-icon>
          </div>
          <span class="mobile-menu-text">Pricing</span>
        </a>

        <!-- Resources Submenu -->
        <div class="mobile-menu-item mobile-submenu-trigger" (click)="toggleMobileSubmenu('resources')">
          <div class="mobile-menu-icon">
            <mat-icon>library_books</mat-icon>
          </div>
          <span class="mobile-menu-text">Resources</span>
          <mat-icon class="mobile-submenu-arrow" [class.rotated]="mobileSubmenuOpen === 'resources'">chevron_right</mat-icon>
        </div>

        <!-- Hidden links for crawlers -->
        <div class="mobile-menu-hidden-links" aria-hidden="true">
          <a routerLink="/getting-started">Getting Started</a>
          <a routerLink="/what-is-planning-poker">What is Planning Poker?</a>
          <a routerLink="/estimation-techniques-comparison">Estimation Techniques Comparison</a>
          <a routerLink="/blog">Blog</a>
          <a routerLink="/faq">FAQ</a>
        </div>

        <!-- Resources Submenu Content -->
        <div class="mobile-submenu" [class.open]="mobileSubmenuOpen === 'resources'">
          <div class="mobile-submenu-header">
            <button class="mobile-submenu-back" (click)="closeMobileSubmenu()">
              <mat-icon>chevron_left</mat-icon>
              <span>Back</span>
            </button>
            <span class="mobile-submenu-title">Resources</span>
          </div>
          
          <div class="mobile-submenu-items">
            <a routerLink="/getting-started" routerLinkActive="active" class="mobile-submenu-item" (click)="closeAllDropdowns(); closeMenu()">
              <div class="mobile-submenu-icon">
                <mat-icon>rocket_launch</mat-icon>
              </div>
              <span class="mobile-submenu-text">Getting Started</span>
            </a>

            <a routerLink="/what-is-planning-poker" routerLinkActive="active" class="mobile-submenu-item" (click)="closeAllDropdowns(); closeMenu()">
              <div class="mobile-submenu-icon">
                <mat-icon>help_outline</mat-icon>
              </div>
              <span class="mobile-submenu-text">What is Planning Poker?</span>
            </a>

            <a routerLink="/estimation-techniques-comparison" routerLinkActive="active" class="mobile-submenu-item" (click)="closeAllDropdowns(); closeMenu()">
              <div class="mobile-submenu-icon">
                <mat-icon>compare</mat-icon>
              </div>
              <span class="mobile-submenu-text">Estimation Techniques Comparison</span>
            </a>

            <a routerLink="/blog" routerLinkActive="active" class="mobile-submenu-item" (click)="closeAllDropdowns(); closeMenu()">
              <div class="mobile-submenu-icon">
                <mat-icon>article</mat-icon>
              </div>
              <span class="mobile-submenu-text">Blog</span>
            </a>

            <a routerLink="/faq" routerLinkActive="active" class="mobile-submenu-item" (click)="closeAllDropdowns(); closeMenu()">
              <div class="mobile-submenu-icon">
                <mat-icon>question_answer</mat-icon>
              </div>
              <span class="mobile-submenu-text">FAQ</span>
            </a>
          </div>
        </div>

        <div class="mobile-menu-divider"></div>

        <a routerLink="/create" class="mobile-cta" (click)="closeAllDropdowns(); closeMenu()">
          Start Planning
        </a>
      </div>
    </div>
  </div>
</nav>
